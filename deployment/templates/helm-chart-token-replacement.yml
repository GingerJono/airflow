parameters:
  acrImageRepository:
  acrImageTag:

steps:
  - task: qetza.replacetokens.replacetokens-task.replacetokens@3
    displayName: Replace tokens in Helm chart
    inputs:
      targetFiles: |
        $(System.DefaultWorkingDirectory)/deployment/custom-values-template.yaml
      ifNoFilesFound: 'error'
      logLevel: 'debug'
    env:
      ACR_IMAGE_REPOSITORY: ${{ parameters.acrImageRepository }}
      ACR_IMAGE_TAG: ${{ parameters.acrImageTag }}
      
  - publish: '$(Build.SourcesDirectory)/deployment/custom-values-template.yaml'
    displayName: Publish Helm custom values yaml for later use
    artifact: 'HelmConfig'
